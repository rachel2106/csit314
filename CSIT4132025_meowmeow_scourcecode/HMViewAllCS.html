<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Homeowners All Cleaning Services</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="homeowners-page">
  <div class="homeownersHeaderBanner">
    <a href="homeownersPage.html">
      <img src="C2Ccleaningservicelogo.png" alt="logo" class="logo-img"/>
    </a>
    <a href="HMViewAllCS.html" class="services-menu">All Cleaning Services</a>
    <a href="HMViewBKHistory.html" class="services-menu">Booking History</a>
    <a href="HMFavourites.html" class="services-menu">Favourites</a>
    <a href="loginPage.html" class="logoutBtn" id="logout">Logout</a>
  </div>

  <main>
    <div class="view-CS">
      <div class="CS">
        <!-- Filters -->
        <select id="categoryFilter">
          <option value="">All Categories</option>
          <option value="Deep Cleaning">Deep Cleaning</option>
          <option value="General House Cleaning">General House Cleaning</option>
          <option value="Move In or Out Cleaning">Move In or Out Cleaning</option>
          <option value="Office & Commercial Cleaning">Office & Commercial Cleaning</option>
          <option value="Pet-Friendly Cleaning">Pet-Friendly Cleaning</option>
          <option value="Post-Construction Cleaning">Post-Construction Cleaning</option>
          <option value="Specialized Cleaning">Specialized Cleaning</option>
        </select>

        <select id="statusFilter">
          <option value="">All Status</option>
          <option value="available">Available</option>
          <option value="unavailable">Unavailable</option>
        </select>

        <select id="priceFilter">
          <option value="">All Prices</option>
          <option value="0-50">$0 - $50</option>
          <option value="51-100">$51 - $100</option>
          <option value="101-200">$101 - $200</option>
          <option value="201-500">$201 - $500</option>
        </select>

        <button id="searchBtn">Search</button>
        <p id="errorContainer"></p>
      </div>
    </div>

    <div id="servicesContainer" class="services-container"></div>
  </main>

  <script type="module">
    import { HMViewAllCSController } from './HMViewAllCSController.js';

    const categoryFilter = document.getElementById("categoryFilter");
    const priceFilter = document.getElementById("priceFilter");
    const statusFilter = document.getElementById("statusFilter");
    const searchBtn = document.getElementById("searchBtn");
    const servicesContainer = document.getElementById("servicesContainer");
    const errorContainer = document.getElementById("errorContainer");

    function displayError(message) {
      errorContainer.textContent = message;
      errorContainer.style.color = "red";
    }

    function clearError() {
      errorContainer.textContent = "";
    }

    function displayServices(services) {
      servicesContainer.innerHTML = "";

      if (!services || services.length === 0) {
        servicesContainer.innerHTML = "<p>No cleaning services found.</p>";
        return;
      }

      services.forEach(service => {
        const div = document.createElement("div");
        div.classList.add("service-card");
        div.innerHTML = `
          <h3>${service.name || "Unnamed Service"}</h3>
          <p><strong>Category:</strong> ${service.category}</p>
          <p><strong>Status:</strong> ${service.status}</p>
          <p><strong>Price:</strong> $${service.price}</p>
          <p><strong>View Count:</strong> ${service.viewCount || 0}</p>
          <p><strong>Shortlisted:</strong> ${service.shortlisted || 0}</p>
          <button class="book-btn" data-id="${service.id}">Book Now</button>
          <button class="fav-btn" data-id="${service.id}">Add to Favourites</button>
        `;
        servicesContainer.appendChild(div);
      });

      // Attach button listeners
      document.querySelectorAll(".book-btn").forEach(button => {
        button.addEventListener("click", () => {
          const id = button.getAttribute("data-id");
          alert(`Redirect to booking page for service ID: ${id}`);
          // window.location.href = `HMBookService.html?serviceId=${id}`;
        });
      });

      document.querySelectorAll(".fav-btn").forEach(button => {
        button.addEventListener("click", async () => {
          const id = button.getAttribute("data-id");
          alert(`Service ID ${id} added to favourites!`);
          // Call a controller function to update Firestore if needed
          // await HMViewAllCSController.addToFavourites(id);
        });
      });
    }

    async function applyFilters() {
      clearError();
      try {
        const filters = {
          category: categoryFilter.value,
          price: priceFilter.value,
          status: statusFilter.value
        };

        const services = await HMViewAllCSController.getFilteredServices(filters);
        displayServices(services);
      } catch (err) {
        console.error("Error fetching filtered services:", err);
        displayError("Something went wrong while applying filters. Please try again.");
      }
    }

    searchBtn.addEventListener("click", applyFilters);

    window.addEventListener("DOMContentLoaded", async () => {
      clearError();
      try {
        const services = await HMViewAllCSController.getAllServices();
        displayServices(services);
      } catch (err) {
        console.error("Error loading services:", err);
        displayError("Failed to load services. Please check your connection.");
      }
    });

    document.getElementById("logout").addEventListener("click", () => {
      window.location.href = "loginPage.html";
    });
  </script>
</body>
</html>
